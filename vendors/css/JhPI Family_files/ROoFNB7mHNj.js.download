if (self.CavalryLogger) { CavalryLogger.start_js(["rAoRw"]); }

__d("XAssociateGroupThreadController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/groups/messenger/associate_group_thread/",{})}),null);
__d("XGroupSideConversationCreateController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/groups/side_conversation/",{post_id:{type:"Int"}})}),null);
__d("MultiChatController",["AsyncRequest","AsyncSignal","ChatOpenTabEventLogger","FantaTabActions","Form","MercuryDispatcher","MercuryIDs","MercuryLocalIDs","MercuryThreadIDMap","MercuryViewer","MercuryServerDispatcher","MercuryThreads","XAssociateGroupThreadController","XGroupSideConversationCreateController"],(function a(b,c,d,e,f,g){__p&&__p();var h=c("MercuryDispatcher").get(),i=c("MercuryThreadIDMap").get(),j=c("MercuryThreads").get(),k=c("XGroupSideConversationCreateController").getURIBuilder().getURI().toString(),l=c("XAssociateGroupThreadController").getURIBuilder().getURI().toString();function m(){}Object.assign(m,{subscribe:function o(p,q){p.subscribe("confirm",function(){this.createGroupThreadFromChooserDialog(p,q)}.bind(this))},subscribeFromPost:function o(p,q){p.subscribe("confirm",function(){this.createGroupPostThreadFromChooserDialog(p,q)}.bind(this))},createGroupPostThreadFromChooserDialog:function o(p,q){var r=c("Form").serialize(p.getRoot()),s=JSON.parse(r.profileChooserItems),t=Object.keys(s).filter(function(u){return!!s[u]});m.createThreadForFBIDs(t);new(c("AsyncRequest"))().setURI(k).setData({post_id:q}).send();p.hide()},createGroupThreadFromChooserDialog:function o(p,q){__p&&__p();var r=c("Form").serialize(p.getRoot()),s=JSON.parse(r.profileChooserItems),t=[];for(var u in s)if(s[u])t.push(u);var v=m.createThreadForFBIDs(t),w=h.subscribe("update-thread-ids",function(x,y){for(var z in y)if(y[z]==v){var A=j.getThreadMetaNow(v),B=i.getServerIDFromClientIDNow(v);if(A&&!A.is_canonical&&B)c("MercuryServerDispatcher").trySend(l,{group_id:q,thread_id:B});new(c("AsyncSignal"))("/ajax/groups/chat/log",{group_id:q,message_id:z}).send();h.unsubscribe(w);break}});p.hide()},createThreadForTokens:function o(p){__p&&__p();var q=c("MercuryViewer").getID();if(!p.length)return;p=p.filter(function(s){return s!==q});var r;if(p.length===0)return;else if(p.length===1){r=c("MercuryIDs").getThreadIDFromParticipantID(p[0]);c("FantaTabActions").openTab(r,"created_locally_from_tokens");c("ChatOpenTabEventLogger").logAutoOpen("ChatTabView",r)}else{r=c("MercuryLocalIDs").generateThreadID();p.unshift(q);j.createNewLocalThread(r,p);c("FantaTabActions").openTab(r,"created_locally_from_tokens");c("ChatOpenTabEventLogger").logAutoOpen("MultiChatController",r)}return r},createThreadForFBIDs:function o(p){var q=[];for(var r=0;r<p.length;r++)q.push("fbid:"+p[r]);return m.createThreadForTokens(q)}});var n={};n[l]={mode:c("MercuryServerDispatcher").IMMEDIATE};c("MercuryServerDispatcher").registerEndpoints(n);f.exports=m}),null);
__d("MessengerDiscoveryEntryPoints",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({BROWSER_PROFILE_ICON:"browser_profile_icon",CHECKBOX_PLUGIN:"checkbox_plugin",SEARCH:"search",SEARCH_HOME:"search:home",SEARCH_PEOPLE:"search:people",SEARCH_GAMES:"search:games",SEARCH_DISCOVER:"search:discover",FB_PAGE:"fb_page",FB_PAGE_PAGE_HEADER:"fb_page:page_header",FB_PAGE_FB_PAGE_CTA_PAGES_ACTIONS_UNIT:"fb_page:fb_page_cta_pages_actions_unit",FB_PAGE_JEWEL_THREAD:"fb_page:jewel_thread",FB_PAGE_PAGES_MANAGER_USER_MESSAGE_PROMPT:"fb_page:pages_manager_user_message_prompt",FB_PAGE_PAGES_INFO:"fb_page:pages_info",FB_PAGE_LOADED_FROM_DATA:"fb_page:loaded_from_data",FB_PAGE_HOVER_CARD:"fb_page:hover_card",FB_PAGE_CHAT_SIDEBAR_TYPEAHEAD:"fb_page:chat_sidebar_typeahead",FB_PAGE_DYNAMICHOVERCARD:"fb_page:dynamicHoverCard",FB_PAGE_ABOUT_ROW:"fb_page:about_row",FB_PAGE_PYMM_RHC:"fb_page:pymm_rhc",FB_PAGE_GROUPS_RHC:"fb_page:groups_rhc",FB_PAGE_CONTEXT_CARD:"fb_page:context_card",FB_PAGE_CONTEXTUAL_RECOMMENDATIONS:"fb_page:contextual_recommendations",FB_PAGE_SEARCHENTITYCARD:"fb_page:searchEntityCard",FB_PAGE_MESSAGE_RECEIVED:"fb_page:message_received",FB_PAGE_PAGE_HOVERCARD:"fb_page:page_hovercard",CUSTOMER_CHAT_PLUGIN:"customer_chat_plugin",MDOTME:"mdotme",MDOTME_FBPAGE:"mdotme:fbpage",MDOTME_CHATEXTENSION:"mdotme:chatextension"})}),null);
__d("MessengerDiscoveryLoggingEnums",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({ENTRYPOINT_PREFIX:"entrypoint:"})}),null);
__d("MessengerDiscoveryEntryPointsLoggingHelper",["MessengerDiscoveryEntryPoints","MessengerDiscoveryLoggingEnums"],(function a(b,c,d,e,f,g){"use strict";var h={getEntryPointsLoggingTagStr:function i(j){if(j.length==0||Object.values(c("MessengerDiscoveryEntryPoints")).indexOf(j[0])==-1)throw new Error("Please use enums in MessengerDiscoveryEntryPoints class");return c("MessengerDiscoveryLoggingEnums").ENTRYPOINT_PREFIX+j.join(":")}};f.exports=h}),null);
__d("FantaReducersSendMessages",["AsyncRequest","Bootloader","ChatTabViewEvents","EmojiLikeUtils","EmojiState","FantaMessageActions","FantaTabActions","FantaTypeComposer","FantaTypeFileUploader","FantaTypeSharePreview","FantaTypeTabContents","MercuryAPIArgsSource","MercuryBlockedParticipants.bs","MercuryIDs","MercuryLogMessageType","MercuryMessageActions","MercuryMessageObject","MercuryParticipants","MercurySheetPolicy","MercurySourceType","MercuryThreadActions","MercuryThreadIDMap","MercuryThreadInfo","MercuryThreads","MessageRequestUtils","MessengerAdminGroupUtils","MessengerEmojiUsageUtils","MessengerDiscoveryEntryPoints","MessengerDiscoveryEntryPointsLoggingHelper","MessengerUploadFilesUtil.bs","MultiChatController","SiteData","XMessagingSetThreadStateController","getPageIDFromThreadID","setImmediate"],(function aa(ba,a,ca,da,b,ea){"use strict";__p&&__p();var c=a("MercuryBlockedParticipants.bs").get(),d=a("MercuryMessageActions").get(),e=a("MercuryMessageObject").get(),f=a("MercuryThreadActions").get(),g=a("MercuryThreadIDMap").get(),h=a("MercuryThreads").get(),i=a("FantaMessageActions").Types,j=/^\s*$/,k="/ajax/chat/multichat/name_conversation/dismiss.php";function l(t,u){__p&&__p();switch(u.type){case i.UPDATE_GROUP_NAME:var v=u.threadID,w=u.newName,x=t.mercury.tabContents.get(v);if(!x)return t;var y=x.thread;if(!y)return t;var z=y.name,A=a("MessengerAdminGroupUtils").isJoinableThread(y);if((w||z)&&w!==z)if(!A)d.send(e.constructLogMessageObject(a("MercurySourceType").CHAT_WEB,v,a("MercuryLogMessageType").THREAD_NAME,{name:w}),null,a("MercuryAPIArgsSource").CHAT);else g.getServerIDFromClientID(v,function(B){var C=a("XMessagingSetThreadStateController").getURIBuilder().getURI();new(a("AsyncRequest"))().setURI(C).setData({thread_id:B,thread_name:w}).send()});g.getServerIDFromClientID(v,function(B){new(a("AsyncRequest"))(k).setData({thread_fbid:B}).send()});t=t.mergeIn(["mercury","tabContents",v],{openSheet:null})}return t}function m(t,u){__p&&__p();switch(u.type){case i.SEND_GROUP_MESSAGE:var v=u.threadID,w=t.mercury.tabContents.get(v),x=w.thread,y=w.typeahead;if(!y||!x)return t;var z=h.isEmptyLocalThread(v),A=y.getSelectedParticipantIDs();if(x.is_canonical_user||z){var B=x.participants;a("setImmediate")(function(){return a("MultiChatController").createThreadForTokens(B.concat(A))})}else{var C=a("MessengerAdminGroupUtils").shouldInvite(x);if(C)A.forEach(function(E){var F=a("MercuryIDs").getThreadIDFromParticipantID(E);if(F)d.send(e.constructUserGeneratedMessageObject(x.joinable_mode.link,a("MercurySourceType").CHAT_WEB,F))});else d.send(e.constructLogMessageObject(a("MercurySourceType").CHAT_WEB,v,a("MercuryLogMessageType").SUBSCRIBE,{added_participants:A}))}var D=u.tabID||u.threadID;t=t.mergeIn(["mercury","tabContents",D],{typeahead:null})}return t}function n(t,u){__p&&__p();var v,w;switch(u.type){case i.SEND_HOT_LIKE:case i.SEND_MESSAGE:case i.SEND_PHOTO:case i.SEND_STICKER:var x=u.message,y=u.threadID,z=x?x.mentions:null;if(x)x=x.message;var A=t.tabGroup.tabs.get(u.threadID),B=A&&A.entryPoint||null;if(Array.isArray(B))B=B[0];switch(B){case"compose_link":B="chat_sidebar_new_message";break;case"jewel_new_message":B="jewel_new_message";break;case"created_locally_from_tokens":B="one_to_one_plus";break}var C=u.emoji,D=u.onSendSuccess,E=u.photoData,F=u.size,G=u.source,H=u.stickerID,I=t.mercury.tabContents.get(y),J=I.composer,K=I.signatureID,L=I.threadPreviewID,M=I.threadPreviewRecipients,N=J.fileUploader,O=J.sharePreview;y=L||y;var P=I.thread,Q=!!(!x&&C&&F),R=!!(!x&&H),S=h.isEmptyLocalThread(y);if(Q)x=C;else if(R||E)x="";var T=P&&P.is_canonical&&!a("MercuryThreadInfo").canReply(P),U=!!(O.params&&O.type);if(o(N,O))t=t.mergeIn(["mercury","tabContents",y],{openSheet:a("MercurySheetPolicy").sheets.ChatUploadWarningTabSheet});else if(T&&P)p(P);else if(!j.test(x)||N.uploadedFiles.size>0||U||R||E){var V=a("MessengerEmojiUsageUtils").findAllEmojis(x);if(V.length>0)a("EmojiState").updateRecentlyUsed(V);var W=N.getTypeIDs(a("FantaTypeFileUploader").fileTypes.GENERIC_ATTACHMENT),X=q(y,x,W,O,Q,N,F,G,R,H,E,M,z,K,B);if(X){if(t.mercury.tabContents.get(y))t=t.mergeIn(["mercury","tabContents",y],{composer:new(a("FantaTypeComposer"))()});if(L)(function(){var Y=u.threadID;if(!t.mercury.tabContents.get(L))t=t.setIn(["mercury","tabContents",L],new(a("FantaTypeTabContents"))({id:L}));a("setImmediate")(function(){return a("FantaTabActions").replaceTab(Y,L)})})()}if(X&&D)D(X)}if(!o(N,O))t=t.mergeIn(["mercury","tabContents",y],{openSheet:null});if(S&&M&&M.size>1)(function(){var Y=a("MercuryIDs").tokenize(y).value;a("Bootloader").loadModules(["MessengerWebChatEventsTypedLogger","MessengerWebChatEventType"],function(Z,$){new Z().setEvent($.CLICK_NEW_MESSAGE).setOfflineThreadingID(Y).setEntryPoint(B).log()},"FantaReducersSendMessages")})();return t}return t}function o(t,u){return!!(t.uploadingFiles.size>0)}function p(t){var u=t.thread_id,v=a("MercuryIDs").getParticipantIDFromFromThreadID(u);if(v&&t)a("MercuryParticipants").get(v,function(w){a("Bootloader").loadModules(["MessageBlockedDialog"],function(x){x.show(u,t.can_reply,c.isMessageBlocked(t),w.short_name)},"FantaReducersSendMessages")})}function q(t,u,v,w,x,y,z,A,B,C,D,E,F,G,H){__p&&__p();if(!A)A=a("MercurySourceType").CHAT_WEB;var I=e.constructUserGeneratedMessageObject(u,a("MercurySourceType").CHAT_WEB,t);if(H){if(!I.tags)I.tags=[];var J=a("getPageIDFromThreadID")(t);if(J!==null&&Object.values(a("MessengerDiscoveryEntryPoints")).indexOf(H)!==-1)I.tags.push(a("MessengerDiscoveryEntryPointsLoggingHelper").getEntryPointsLoggingTagStr([H]));I.tags.push("web:trigger:"+H)}if(v.length>0){I.has_attachment=true;I.raw_attachments=v}if(F&&F.length)I.profile_ranges=I.profile_xmd=F;if(B){I.has_attachment=true;I.sticker_id=C}if(!x&&w.params&&w.type){var K={share_params:w.params.get("data"),share_type:w.type};if(K){I.has_attachment=true;I.shareable_attachment=K}}I.signatureID=G;I.ui_push_phase=a("SiteData").push_phase;if(D){I.content_attachment=null;d.addAttachmentPlaceholder(I,D.upload_id,D)}else if(!x){if(u||I.has_attachment)r(I,t,E);s(y,t,E)}else if(z&&A){I.has_attachment=false;d.send(function(){a("EmojiLikeUtils").setEmojiSize(I,z||"");return a("EmojiLikeUtils").setEmojiSource(I,A||"")}())}f.markRead(t);f.markSeen(t);return I}function r(t,u,v){__p&&__p();if(h.isEmptyLocalThread(u)){if(v)f.addParticipants(u,v.toArray());t.offline_threading_id=a("MercuryIDs").tokenize(u).value;var w=h.getThreadMetaNow(u);if(w)t.specific_to_list=Array.from(w.participants)}d.send(t,function(u){var x=h.getThreadMetaNow(u);if(x&&a("MessageRequestUtils").isMessageRequest(x))f.movePendingToInbox(u);if(x&&x.thread_id&&x.other_user_fbid&&a("getPageIDFromThreadID")(x.thread_id))a("ChatTabViewEvents").inform("chat-send-to-page",{pageID:x.other_user_fbid})})}function s(t,u,v){__p&&__p();if(t.uploadedFiles.size===0)return;var w=a("MessengerUploadFilesUtil.bs").supportAttachments;for(var x in w){var y=a("MessengerUploadFilesUtil.bs").getAttachmentIDs(t,x);if(Array.isArray(y)){var z=e.constructAttachmentMessageObject(a("MercurySourceType").CHAT_WEB,u);z[w[x]]=y;r(z,u,v)}}}b.exports={sendGroupMessage:m,sendMessage:n,updateGroupName:l}}),null);